<% product = t("collections.#{@collection}.p#{@id}") %>
<% n_products = t("collections.#{@collection}").keys.length %>

<h2 id="collection-name"><%= t("collections.index.#{@collection}").capitalize %></h2>

<div id="details">
  <div id ="pic-title-container">
    <h3 id="pic-title"><%= product[:title] %></h3>
  </div>
  <p id="pic-description"><span class="text"><%= product[:description] %></span> [<%= link_to t('collections.more_details'), collections_showpic_path(:name => @collection, :id => @id), {:id => 'more-details'} %>]</p>
  <div id="etsy"><%= link_to t('fields.buy_etsy'), product[:etsy_link], {:class => 'etsy', :title => t('fields.buy_etsy_title')} %> (<span id="price"><%= product[:price] %></span>)</div>
  
</div>

<div id="collection">
  <% 1.upto(n_products) do |n| %>
    <% product = t("collections.#{@collection}.p#{n}") %>
  
    <%= link_to collections_showpic_path(:name => @collection, :id => n), {:title => product[:title]} do %>
      <%= image_tag "/images/collections/#{@collection}/pic/p#{n}.jpg", :alt => product[:description], :title => product[:title], 'data-price' => product[:price], 'data-etsy-link' => product[:etsy_link] %>
    <% end %>
  <% end %>
</div>

<% photographs = []; t("collections.#{@collection}").each{|name, product| photographs << product[:photograph]}; photographs = photographs.sort.uniq.join(', ') %>
<% models = []; t("collections.#{@collection}").each{|name, product| models << product[:model]}; models = models.sort.uniq.join(', ') %>

<div id="credits">
  <div><%= t('photographs', {:names => photographs}) %></div>
  <div><%= t('models', {:names => models}) %></div>
</div>

<script>
  Galleria.loadTheme('/javascripts/galleria/src/themes/classic/galleria.classic.js');
  
  $(function () {
    
    $('#collection').galleria({
  
      show_info: false,
      
      show: <%= (@id ? (@id.to_i - 1) : 0).to_json %>,
      
      on_image: function(img,thumb) {
        var data = this.getData(this.getIndex());
        var price = ($(data.original).data('price'));
        var etsyLink = ($(data.original).data('etsy-link'));
        
        $('#pic-title').text(data.title);
        $('#pic-description .text').text(data.description);
        $('#more-details').attr('href', data.link);
        $('#etsy a').attr('href', etsyLink);
        $('#price').text(price);
      },
      
      extend: function () {
        var that = this;
        
        //this.bindTooltip( this.get('images'), <%= raw t('collections.more').to_json %>);
        
        $(document).bind('keydown', function (e) {
          if (e.target.type == 'textarea' || e.target.type == 'input') { return true; }
  
          if (e.keyCode == 39) { that.next(); return false; }
          else if (e.keyCode == 37) { that.prev(); return false; }
        });
      }
    });
  });

</script>